@page "/query/{connectionName}/{table?}/{index?}"
@using System.Web
@inject LocationQueryRunner Runner
@inject NavigationManager NavigationManager

<PageTitle>@Result.RootName</PageTitle>

<DefaultLayout>
    <NavItems>
        <li class="nav-item"><a class="nav-link text-muted" href="@Result.RootUrl">@Result.RootName</a></li>
    </NavItems>

    <ChildContent>
        <div class="row small text-muted d-xl-none">
            <div class="col-lg-12">
                <p><i class="fa fa-exclamation-triangle"></i> Note that there are some explanatory texts on larger screens.</p>
            </div>
        </div>

        <div class="row">
            <div class="entity-context col-12 col-xl-10">
                @((MarkupString)Result.Html)

                @*<pre class="debug-xml-original">
            @Model.Html
            </pre>*@

            </div>

            <div class="d-none d-xl-block col-xl-2 small text-muted">
                <HelpText QueryType="@Result.QueryType" />
            </div>
        </div>
    </ChildContent>
</DefaultLayout>

@code {

    [Parameter]
    public String ConnectionName { get; set; }

    [Parameter]
    public String Table { get; set; }

    [Parameter]
    public String Index { get; set; }

    public LocationQueryResult Result { get; set; }


    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        var query = new Uri(NavigationManager.Uri).Query;

        var queryParams = HttpUtility.ParseQueryString(query);

        Result = Runner.Query(ConnectionName, Table, Index, queryParams);
    }
}
